<div class="container-fluid">
  <nav aria-label="breadcrumb" class="mb-3">
    <ol class="breadcrumb">
      <li class="breadcrumb-item"><a [routerLink]="['/trabajadores', trabajadorId]" style="cursor:pointer;"><i class="bi bi-house-door"></i></a></li>
      <li class="breadcrumb-item"><a [routerLink]="['/trabajadores', trabajadorId]" style="cursor:pointer;">Trabajador</a></li>
      <li class="breadcrumb-item active" aria-current="page">Editar</li>
    </ol>
  </nav>

  <h2 class="fw-bold mb-4">Editar trabajador</h2>

  @if (isLoading) {
    <div class="text-center my-5">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Cargando...</span>
      </div>
    </div>
  }

  @if (!isLoading) {
    <div class="card shadow-sm" style="max-width:1100px;">
      <div class="card-body">
        <form [formGroup]="trabajadorForm" (ngSubmit)="guardar()" novalidate>
          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label fw-semibold">Nombre *</label>
              <input type="text" formControlName="nombre" class="form-control" placeholder="Escribe aquí el nombre"
                [class.is-invalid]="f.nombre.touched && f.nombre.invalid">
              @if (f.nombre.touched && f.nombre.invalid) {
                <div class="invalid-feedback">Nombre requerido mínimo 2 caracteres</div>
              }
            </div>
            <div class="col-md-6">
              <label class="form-label fw-semibold">Apellido *</label>
              <input type="text" formControlName="apellido" class="form-control" placeholder="Escribe aquí el apellido"
                [class.is-invalid]="f.apellido.touched && f.apellido.invalid">
              @if (f.apellido.touched && f.apellido.invalid) {
                <div class="invalid-feedback">Apellido requerido mínimo 2 caracteres</div>
              }
            </div>
          </div>

          <div class="row g-3 mt-1">
            <div class="col-md-6">
              <label class="form-label fw-semibold">DNI *</label>
              <input type="text" formControlName="dni" class="form-control" placeholder="Ej: 12345678A"
                maxlength="9"
                [class.is-invalid]="f.dni.touched && f.dni.invalid">
              @if (f.dni.touched && f.dni.invalid) {
                <div class="invalid-feedback">
                  @if (f.dni.hasError('required')) {
                    <span>DNI requerido</span>
                  }
                  @if (f.dni.hasError('pattern')) {
                    <span>Formato: 8 dígitos + letra (Ej: 12345678A)</span>
                  }
                </div>
              }
            </div>
            <div class="col-md-6">
              <label class="form-label fw-semibold">Email *</label>
              <input type="email" formControlName="email" class="form-control" placeholder="ejemplo@correo.com"
                [class.is-invalid]="f.email.touched && f.email.invalid">
              @if (f.email.touched && f.email.invalid) {
                <div class="invalid-feedback">
                  @if (f.email.hasError('required')) {
                    <span>Email requerido</span>
                  }
                  @if (f.email.hasError('email')) {
                    <span>Email inválido</span>
                  }
                </div>
              }
            </div>
          </div>

          <div class="row g-3 mt-1">
            <div class="col-md-6">
              <label class="form-label fw-semibold">Teléfono *</label>
              <input type="text" formControlName="telefono" class="form-control" placeholder="Ej: 612345678"
                maxlength="9"
                [class.is-invalid]="f.telefono.touched && f.telefono.invalid">
              @if (f.telefono.touched && f.telefono.invalid) {
                <div class="invalid-feedback">
                  @if (f.telefono.hasError('required')) {
                    <span>Teléfono requerido</span>
                  }
                  @if (f.telefono.hasError('pattern')) {
                    <span>Debe tener 9 dígitos</span>
                  }
                </div>
              }
            </div>
            <div class="col-md-6">
              <label class="form-label fw-semibold">Rol *</label>
              <select formControlName="rol" class="form-select"
                [class.is-invalid]="f.rol.touched && f.rol.invalid">
                <option value="">Seleccionar rol...</option>
                <option value="Agricultor">Agricultor</option>
                <option value="Operador de Maquinaria">Operador de Maquinaria</option>
                <option value="Supervisor">Supervisor</option>
                <option value="Técnico">Técnico</option>
                <option value="Administrador">Administrador</option>
              </select>
              @if (f.rol.touched && f.rol.invalid) {
                <div class="invalid-feedback">Rol requerido</div>
              }
            </div>
          </div>

          <div class="row g-3 mt-1">
            <div class="col-md-6">
              <label class="form-label fw-semibold">Fecha de Alta *</label>
              <input type="date" formControlName="fechaAlta" class="form-control"
                [class.is-invalid]="f.fechaAlta.touched && f.fechaAlta.invalid">
              @if (f.fechaAlta.touched && f.fechaAlta.invalid) {
                <div class="invalid-feedback">La fecha es obligatoria</div>
              }
            </div>
          </div>

          <div class="d-flex justify-content-end gap-3 mt-4">
            <button type="button" class="btn btn-outline-primary" (click)="atras()">ATRÁS</button>
            <button type="submit" class="btn btn-info text-white px-4" [disabled]="trabajadorForm.invalid || isLoading">
              @if (isLoading) {
                <span class="spinner-border spinner-border-sm me-2"></span>
              }
              GUARDAR
            </button>
          </div>
        </form>
      </div>
    </div>
  }
</div>
